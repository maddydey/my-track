<!DOCTYPE html>
<html lang="ru">
<head>
    <title>Premium Secure Track</title>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    
    <link rel="stylesheet" href="https://unpkg.com/leaflet@1.9.4/dist/leaflet.css" />
    <script src="https://unpkg.com/leaflet@1.9.4/dist/leaflet.js"></script>
    
    <style>
        /* –û–±—â–∏–π —Å—Ç–∏–ª—å –≤ —Ç–µ–º–Ω—ã—Ö —Ç–æ–Ω–∞—Ö Apple */
        body, html, #map { 
            height: 100%; 
            margin: 0; 
            background: #121212; 
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, Helvetica, Arial, sans-serif;
        }

        /* –°—Ç–∏–ª—å –≤—Å–ø–ª—ã–≤–∞—é—â–µ–≥–æ –æ–∫–Ω–∞ (Popup) */
        .leaflet-popup-content-wrapper {
            background: #2c2c2e;
            color: #fff;
            border-radius: 12px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.5);
        }
        .leaflet-popup-tip { background: #2c2c2e; }

        /* –ö–Ω–æ–ø–∫–∞ —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è */
        .locate-button {
            position: absolute;
            bottom: 30px;
            right: 20px;
            z-index: 1000;
            background: #007aff;
            color: white;
            border: none;
            border-radius: 50%;
            width: 56px;
            height: 56px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.3);
            display: flex;
            align-items: center;
            justify-content: center;
            cursor: pointer;
            transition: transform 0.2s;
        }
        .locate-button:active { transform: scale(0.9); }
        .locate-button svg { width: 24px; height: 24px; fill: white; }

        /* –ö–∞—Å—Ç–æ–º–Ω—ã–π –ø—É–ª—å—Å–∏—Ä—É—é—â–∏–π –º–∞—Ä–∫–µ—Ä */
        .user-marker {
            width: 20px;
            height: 20px;
            background: #007aff;
            border: 3px solid white;
            border-radius: 50%;
            box-shadow: 0 0 10px rgba(0,122,255,0.8);
            animation: pulse 2s infinite;
        }
        @keyframes pulse {
            0% { box-shadow: 0 0 0 0 rgba(0,122,255, 0.7); }
            70% { box-shadow: 0 0 0 15px rgba(0,122,255, 0); }
            100% { box-shadow: 0 0 0 0 rgba(0,122,255, 0); }
        }
    </style>
</head>
<body>

    <div id="map"></div>
    
    <button class="locate-button" onclick="focusOnMarker()" title="–¶–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞—Ç—å">
        <svg viewBox="0 0 24 24"><path d="M12 8c-2.21 0-4 1.79-4 4s1.79 4 4 4 4-1.79 4-4-1.79-4-4-4zm8.94 3c-.46-4.17-3.77-7.48-7.94-7.94V1h-2v2.06C6.83 3.52 3.52 6.83 3.06 11H1v2h2.06c.46 4.17 3.77 7.48 7.94 7.94V23h2v-2.06c4.17-.46 7.48-3.77 7.94-7.94H23v-2h-2.06zM12 19c-3.87 0-7-3.13-7-7s3.13-7 7-7 7 3.13 7 7-3.13 7-7 7z"/></svg>
    </button>

    <script>
        const urlParams = new URLSearchParams(window.location.search);
        const lat = parseFloat(urlParams.get('lat'));
        const lon = parseFloat(urlParams.get('lon'));
        let map, marker;

        if (!isNaN(lat) && !isNaN(lon)) {
            // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã —Å –ø–ª–∞–≤–Ω—ã–º –∑—É–º–æ–º
            map = L.map('map', {
                zoomControl: false, // –û—Ç–∫–ª—é—á–∞–µ–º —Å—Ç–∞–Ω–¥–∞—Ä—Ç–Ω—ã–µ –∫–Ω–æ–ø–∫–∏ –∑—É–º–∞ –¥–ª—è —á–∏—Å—Ç–æ—Ç—ã
                attributionControl: false
            }).setView([lat, lon], 17);

            // –ö—Ä–∞—Å–∏–≤–∞—è —Ç–µ–º–Ω–∞—è –∫–∞—Ä—Ç–∞ (CartoDB Voyager Dark)
            L.tileLayer('https://{s}.basemaps.cartocdn.com/rastertiles/voyager_labels_under/{z}/{x}/{y}{r}.png', {
                maxZoom: 20
            }).addTo(map);

            // –ö–∞—Å—Ç–æ–º–Ω—ã–π –º–∞—Ä–∫–µ—Ä
            const icon = L.divIcon({
                className: 'user-marker-container',
                html: '<div class="user-marker"></div>',
                iconSize: [20, 20],
                iconAnchor: [10, 10]
            });

            marker = L.marker([lat, lon], {icon: icon}).addTo(map)
                .bindPopup("<b>–í—ã –∑–¥–µ—Å—å</b><br>–¢–æ—á–∫–∞ –∑–∞—à–∏—Ñ—Ä–æ–≤–∞–Ω–∞", {closeButton: false});

            // –§—É–Ω–∫—Ü–∏—è —Ü–µ–Ω—Ç—Ä–∏—Ä–æ–≤–∞–Ω–∏—è
            window.focusOnMarker = function() {
                map.flyTo([lat, lon], 18, { duration: 1.5 });
            };
        } else {
            document.body.innerHTML = "<div style='color:#8e8e93; text-align:center; margin-top:50%; font-size:18px;'>üõ∞ –û–∂–∏–¥–∞–Ω–∏–µ —Å–∏–≥–Ω–∞–ª–∞...</div>";
        }
    </script>
</body>
</html>